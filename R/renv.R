
#' Activate an R Virtual Environment
#'
#' Activate an \R virtual environment. This binds the requested project to the
#' virtual environment called `name`. Newly-launched \R sessions in this project
#' will use this virtual environment.
#'
#' @inheritParams renv-params
#'
#' @family renv
#'
#' @export
activate <- function(project = NULL) {
  project <- project %||% renv_state$project()

  # prepare renv infrastructure
  renv_write_infrastructure(project)
  renv_bootstrap()

  # set library paths now so that they're properly restored in new sessions
  renv_load_libpaths(project)

  renv_request_restart(project, reason = "Virtual environment activated")
}

#' Deactivate an R Virtual Environment
#'
#' Deactivate the active virtual environment.
#'
#' @inheritParams renv-params
#'
#' @family renv
#'
#' @export
deactivate <- function(project = NULL) {
  project <- project %||% renv_state$project()

  renv_remove_rprofile(project)
  renv_envvars_restore()

  renv_request_restart(project, reason = "Virtual environment deactivated")
}

#' Load an R Virtual Environment
#'
#' Load the \R virtual environment currently associated with a project.
#'
#' Normally, this is done automatically on session startup by the infrastructure
#' generated by [activate()] -- users should not need to call this function
#' directly.
#'
#' @inheritParams renv-params
#'
#' @export
load <- function(project = NULL) {

  project <- project %||% renv_state$project()
  renv_state$project(project)

  renv_envvars_save()
  renv_load_envvars(project)
  renv_load_libpaths(project)

  manifest <- renv_manifest_load(project)
  if (!is.null(manifest)) {
    renv_load_r_version(manifest$R$Version)
    renv_load_repos(manifest$R$Repositories)
  }

  renv_load_finish()

}

