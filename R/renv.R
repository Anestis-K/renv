
#' Activate a Project
#'
#' Use `activate()` to write the infrastructure needed to ensure that
#' newly-launched \R projects will load the project's private library on launch,
#' alongside any other project-specific state recorded for the project.
#'
#' @inheritParams renv-params
#'
#' @family renv
#'
#' @export
activate <- function(project = NULL) {
  project <- project %||% renv_state$project()

  # prepare renv infrastructure
  renv_write_infrastructure(project)
  renv_bootstrap()

  # set library paths now so that they're properly restored in new sessions
  renv_load_libpaths(project)

  renv_request_restart(project, reason = "renv activated")
}

#' Deactivate a Project
#'
#' Use `deactivate()` to remove the infrastructure used by `renv` to activate
#' projects for newly-launched \R sessions.
#'
#' @inheritParams renv-params
#'
#' @family renv
#'
#' @export
deactivate <- function(project = NULL) {
  project <- project %||% renv_state$project()

  renv_remove_rprofile(project)
  renv_envvars_restore()

  renv_request_restart(project, reason = "renv deactivated")
}

#' Load a Project
#'
#' Normally, this is done automatically on session startup by the infrastructure
#' generated by [activate()] -- users should not need to call this function
#' directly.
#'
#' @inheritParams renv-params
#'
#' @export
load <- function(project = NULL) {

  project <- project %||% renv_state$project()
  renv_state$project(project)

  renv_envvars_save()
  renv_load_envvars(project)
  renv_load_libpaths(project)

  lockfile <- renv_lockfile_load(project)
  if (!is.null(lockfile)) {
    renv_load_r_version(lockfile$R$Version)
    renv_load_repos(lockfile$R$Repositories)
  }

  renv_load_finish()

  invisible(project)

}

